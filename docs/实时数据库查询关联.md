## 实时数据库查询关联 <!-- {docsify-ignore} -->

在DataStream API用户自定义Function中直接访问数据库进行关联的方式

优点：

- 开发量小
- 每一条数据都需要请求数据库，数据库压力大
- 关联时基于Processing Time，如果数据有延迟或者重复，会得到与原先不一致的数据

### 同步数据库查询关联

在一个Map Function或者FlatMap Function中访问数据库，处理好关联逻辑后，将结果数据输出

缺点：

- subtask线程会被阻塞，影响吞吐量

应用场景：用于流量低的实时计算 [ 通常不是最好的选择 ]

### 异步数据库查询关联

通过AsyncIO来访问外部数据库的方式。利用数据库提供的异步客户端，AsyncIO可以并发地处理多个请求，很大程度上减少了subtask线程的阻塞。

与同步数据库查询相比：

- 优点：提高了吞吐量

- 缺点：AsyncIO提供了有序和无序两种模式，有序模式下，需要将结果数据保存到checkpoint的状态中，存在一定的内存占用

应用场景：适用于流量低的实时计算

### 带缓存的数据库查询关联

引入缓存可以减少对数据库的请求，减轻数据库压力。

缓存可以使用 WeakHashMap 或者 Guava Cache 实现。 [ 没必要使用Redis或者Ehcache做数据库缓存，相对于Flink作业而言，太重了 ]

相比前面两种关联方式

优点：

- 增加了缓存，较少了数据库压力

缺点：
- 作业刚启动时，仍会对数据库造成一定压力
- 维表的更新，缓存无法及时更新

应用场景：适用于流量低，且维表数据实时性要求不高或者维表更新较少的业务场景